<!doctype html>
<html>
  <head>
    <title>{% block title %}OpenBMC Bot{% endblock %}</title>
    <link rel="stylesheet" type="text/css" href="/bot/style.css" />
  </head>
  <body>
    <div class="header">
      <div class="header-buttons">
        <button
          id="company-toggle"
          onclick="toggleCompanyChanges()"
          title="Toggle company-specific changes"
          style="display: none"
        >
          🏢
        </button>
        <button id="home-button" onclick="goHome()" title="Home">🏠</button>
        <div class="theme-toggle">
          <button id="theme-toggle" onclick="toggleTheme()">
            <span id="theme-icon">🌙</span>
          </button>
        </div>
      </div>
    </div>
    {% block content %}{% endblock %}
    <script>
      // Check for saved theme preference or respect system preference
      const savedTheme = localStorage.getItem("theme");
      const systemPrefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)",
      ).matches;

      if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
        document.body.classList.add("dark-mode");
        document.getElementById("theme-icon").textContent = "☀️";
      } else {
        document.body.classList.add("light-mode");
        document.getElementById("theme-icon").textContent = "🌙";
      }

      function toggleTheme() {
        if (document.body.classList.contains("dark-mode")) {
          document.body.classList.remove("dark-mode");
          document.body.classList.add("light-mode");
          document.getElementById("theme-icon").textContent = "🌙";
          localStorage.setItem("theme", "light");
        } else {
          document.body.classList.remove("light-mode");
          document.body.classList.add("dark-mode");
          document.getElementById("theme-icon").textContent = "☀️";
          localStorage.setItem("theme", "dark");
        }
      }

      function goHome() {
        window.location.href = "/bot";
      }

      // Hide home button on root page
      document.addEventListener("DOMContentLoaded", function () {
        const path = window.location.pathname;
        const homeButton = document.getElementById("home-button");
        if (path === "/bot" || path === "/bot/") {
          homeButton.style.display = "none";
        }

        // Show company toggle button only on report pages and user pages
        // Exclude report-by-repo page as it doesn't show individual changes
        const companyToggle = document.getElementById("company-toggle");
        if (
          (path.includes("/bot/report") &&
            !path.includes("/bot/report-by-repo")) ||
          path.includes("/bot/user")
        ) {
          companyToggle.style.display = "flex";
        }
      });

      // Toggle section visibility
      function toggleSection(sectionName) {
        const section = document.getElementById(sectionName + "-section");
        const button = event.target;
        if (section.style.display === "none") {
          section.style.display = "block";
          button.classList.remove("collapsed");
        } else {
          section.style.display = "none";
          button.classList.add("collapsed");
        }
      }

      // Keep track of company toggle state
      let companyChangesVisible = false;

      // Toggle company-specific changes visibility
      function toggleCompanyChanges() {
        const companyChanges = document.querySelectorAll(
          ".change-card.company-change",
        );
        const button = document.getElementById("company-toggle");

        // Toggle the visibility state
        companyChangesVisible = !companyChangesVisible;

        // Apply the visibility state to all company change cards
        companyChanges.forEach((card) => {
          card.style.display = companyChangesVisible ? "block" : "none";
        });

        // Update button text/icon based on state
        button.textContent = companyChangesVisible ? "🌍" : "🏢";
        button.title = companyChangesVisible
          ? "Hide company-specific changes"
          : "Show company-specific changes";
      }
    </script>
  </body>
</html>
